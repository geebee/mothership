<!DOCTYPE html><!--{{{-->
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>mothership</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" media="screen" href="css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="css/main.css" />
    <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>
    <script type="text/javascript" src="js/knockout-2.1.0.js"></script>
    <script type="text/javascript" src="js/bootstrap.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function() {
            $.getScript("js/ko-utils/bindingHandlers.js", function() {
                console.log("bindingHandlers loaded.");
                $.getScript("js/ko-utils/protectedObservable.js", function() {
                    console.log("protectedObservable util loaded.");
                    $.getScript("js/models/conf.js", function() {
                        console.log("ConfViewModel ready for initialization.");
                        ko.applyBindings(cVM = new ConfViewModel());
                    });

                    var labels, mapped;
                    $('#propertySearch').typeahead({
                        minLength: 3,
                        source: function (query, process) {
                            $.get('/search', { query: query }, function (data) {
                                labels = [];
                                mapped = {};

                                $.each(data.found, function(i, item) {
                                    var tempLabel = item.term + ' (' + item.friendlyName + ')';
                                    mapped[tempLabel] = {friendlyName: item.friendlyName, label: tempLabel};
                                    labels.push(tempLabel);
                                });

                                process(labels);
                            });
                        },
                        updater: function(item) { 
                            console.log("typeahead.updater - item: %s", item);
                            var selfObj = mapped[item];
                            console.log("typeahead.updater - friendlyName: %s", selfObj.friendlyName);
                            cVM.loadConf(selfObj.friendlyName);

                            //replace " (friendlyName)" with nothing in the actual selection
                            //this avoids unnecessary searches by backspacing through extraneous text
                            return item.replace(/ \(.*\)$/,"");
                        },
                        highlighter: function(item) {
                            console.log("typeahead.highlighter - item: %s", item);
                            var selfObj = mapped[item];
                            console.log("typeahead.highlighter- friendlyName: %s", selfObj.friendlyName);
                            //do some modification of the output HTML for the list
                            return item.replace(/ (\(.*\))$/, " <strong>(<i>" + selfObj.friendlyName + "</i>)</strong>");
                        }
                    });
                });
            });
        });
    </script>
    <style type="text/css">
        #wholeBody {
            margin:10px;
        }

        div.hiEdit {
            display: inline-block;
        }
    </style>
</head>
<body>
    <div id="wholeBody" class="row-fluid span12">
        <div id="topBar" class="row-fluid span12">
            <span class="span2 offset1"><strong>Configuration</strong></span>
            <div id="searchBox" class="span4 offset1" style="">
                <input type="text" id="propertySearch"i style="float:left;" data-provide="typeahead" placeholder="search..." />
                <i class="icon-search"></i> 
            </div> <!-- #searchBox.span2.offset6 -->
        </div> <!-- #topBar.row-fluid.span12 -->
        <br/><!--}}}-->
        <div data-bind="with: hostIdentification" id="hostInformationArea" class="row-fluid span5 well" style="margin-left: 32%;"><!--{{{-->
            <!--
            Friendly Name:&nbsp;<span><b data-bind="clickToEdit: friendlyName">&nbsp;</b></span><br/>
            -->
            <div class="hiElement">Friendly Name:&nbsp;<b data-bind="text: friendlyName">&nbsp;</b></div>
            <div class="hiElement">FQDN:&nbsp;<b data-bind="clickToEdit: fqdn">&nbsp;</b></div>
            <div class="hiElement">IP:&nbsp;<b data-bind="clickToEdit: ip">&nbsp;</b></div>
            <div class="hiElement">URL:&nbsp;<b data-bind="clickToEdit: url">&nbsp;</b></div><br/>
            <button data-bind="click: $parent.deleteConf"class="btn btn-block btn-danger" type="button">Delete Configuration</button>
        </div> <!-- #hostInformationArea.row-fluid.span10.container  --><!--}}}-->

        <div id="propertyArea" class="row-fluid span10" style="margin-left: 6%;"><!--{{{-->
            <table class="table table-striped table-hover table-bordered">
                <thead><tr>
                        <th style="width: 45%;">Key</th>
                        <th style="width: 45%;">Value</th>
                        <th style="width: 10%;">Actions</th>
                </tr></thead>
                <tbody data-bind="template: { name: templateToUse, foreach: properties}"></tbody>
            </table>
            <button class="btn" data-bind="click: addProperty, enable: persistedProperties().length < 5">Add another property</button>
            <!-- <button class="btn" data-bind="click: save">Save</button> -->
        </div> <!-- #propertyArea.container --><!--}}}-->
    </div> <!-- #wholeBody.row-fluid.span12  -->

    <script id="viewTemplate" type="text/html"><!--{{{-->
        <tr>
            <td data-bind="text: key" style="table-layout: fixed; text-align: center; overflow: hidden;"></td>
            <td data-bind="text: value" style="table-layout: fixed; text-align: center; overflow: hidden;"></td>
            <td style="text-align:center;" class="buttons">
                <i class="icon-edit" data-bind="click: $root.editElement"></i>
                <i class="icon-trash" data-bind="click: $root.removeProperty"></i>
            </td>
        </tr>
    </script><!--}}}--> 
    <script id="editTemplate" type="text/html"><!--{{{-->
        <tr>
            <td style="text-align: center;">
                <input data-bind="value: key, hasfocus: key.focused" "type="text" class="input-xlarge" placeholder="new key" />
            </td>
            <td style="text-align: center;">
                <input data-bind="value: value" type="text" class="input-xlarge" placeholder="new value">
            </td>
            <td style="text-align: center;" class="buttons">
                <i class="icon-ok" data-bind="click: $root.acceptElementEdit"></i>
                <i class="icon-repeat" data-bind="click: $root.cancelElementEdit"></i>
            </td>
        </tr>
    </script><!--}}}-->
</body>
</html>
